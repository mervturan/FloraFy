<!DOCTYPE html>
<html>
  <head>
    <style>
      #search-container {
        display: flex;
        margin-bottom: 10px;
      }

      #pac-input {
        flex: 1;
        width: 70%;
        padding: 10px;
        font-size: 16px;
      }

      #search-button {
        width: 30%;
        padding: 10px;
        font-size: 16px;
      }

    </style>
  </head>

<body>

    <h1>Map!</h1>
    console.writeLine()

    <!-- Input field for Places search box -->
    <div id="search-container">
      <input id="pac-input" type="text" placeholder="Enter an address">
      <button id="search-button" onclick="geocodeAddress()">Find Address</button>
    </div>
  
    <!-- set the size of the map -->
    <div id="googleMap" style="width: 100%; height: 700px;"></div>

    <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js"></script>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-analytics.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyAw1ZhTibkKJE-OFzAo-XUgZJ7Tc2oLt4I",
        authDomain: "crested-booking-403414.firebaseapp.com",
        projectId: "crested-booking-403414",
        storageBucket: "crested-booking-403414.appspot.com",
        messagingSenderId: "317063797666",
        appId: "1:317063797666:web:07efb983b82fc3d53570fb",
        measurementId: "G-G83ZZ2LJFN"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore();
      
      var map;
      var markers = [];
      var infowindow;

      function initAutocomplete() {
          map = new google.maps.Map(document.getElementById("googleMap"), {
              center: { lat: -33.8688, lng: 151.2195 },
              zoom: 13,
              mapTypeId: "roadmap",
          });

          infowindow = new google.maps.InfoWindow();
          
          db.collection("markers").get().then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              const markerData = doc.data();
              const marker = new google.maps.Marker({
                position: { lat: markerData.lat, lng: markerData.lng }, 
                map: map
              });
              markers.push(marker);
            })
          })

          const input = document.getElementById("pac-input");
          const searchBox = new google.maps.places.SearchBox(input);
          map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

          map.addListener("bounds_changed", () => {
              searchBox.setBounds(map.getBounds());
          });

          searchBox.addListener("places_changed", () => {
              const places = searchBox.getPlaces();

              if (places.length == 0) {
                  return;
              }

              markers.forEach((marker) => {
                  marker.setMap(null);
              });
              markers = [];

              const bounds = new google.maps.LatLngBounds();

              places.forEach((place) => {
                  if (!place.geometry || !place.geometry.location) {
                      console.log("Returned place contains no geometry");
                      return;
                  }

                  markers.push(
                      new google.maps.Marker({
                          map,
                          title: place.name,
                          position: place.geometry.location,
                      })
                  );

                  google.maps.event.addListener(markers[markers.length - 1], "click", function () {
                      infowindow.setContent(place.name);
                      infowindow.open(map, markers[markers.length - 1]);
                  });

                  if (place.geometry.viewport) {
                      bounds.union(place.geometry.viewport);
                  } else {
                      bounds.extend(place.geometry.location);
                  }
              });
              map.fitBounds(bounds);
          });
      }

      function myMap() {
          initAutocomplete();

          google.maps.event.addListener(map, "click", function (event) {
              placeMarker(event.latLng);
          });

          function placeMarker(location) {
              var marker = new google.maps.Marker({
                  position: location,
                  map: map,
              });
              db.collection("markers").add({
                lat: location.lat(),
                lng: location.lng()
              });
              markers.push(marker);
              

              var infowindow = new google.maps.InfoWindow({
                content: "daisy" +"<br>img"
              });
              infowindow.open(map, marker);
              
          }
      }
  </script>

    <!-- your key goes here -->
    <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAw1ZhTibkKJE-OFzAo-XUgZJ7Tc2oLt4I&callback=myMap&libraries=places"
    async defer></script>
    <!-- <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAw1ZhTibkKJE-OFzAo-XUgZJ7Tc2oLt4I&callback=myMap&libraries=places"
        async defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js"></script> -->
        

</body>
</html>


